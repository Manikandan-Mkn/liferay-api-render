# Stage 1: Build the application
FROM liferay/dxp:7.4.13-u80 as builder
COPY . /app
WORKDIR /app
RUN ./gradlew build

# Stage 2: Create the final image
FROM liferay/dxp:7.4.13-u80
COPY --from=builder /app/modules/*.jar /opt/liferay/deploy/
COPY --from=builder /app/wars/*.war /opt/liferay/deploy/
EXPOSE 8080
CMD ["catalina.sh", "run"]